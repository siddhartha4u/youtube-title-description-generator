<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Title & Description Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #0d1117;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Main application logic for the YouTube Title & Description Generator
        document.addEventListener('DOMContentLoaded', () => {
            const app = document.getElementById('app');
            
            // === YOUR API KEY GOES HERE ===
            // 1. Get your key from https://ai.google.dev/
            // 2. Paste it in the quotes below. Do not share your key!
            const apiKey = "AIzaSyDV3LEWbrgzehnlf5dkFHi7LHB-kNKz-mk";
            // ==============================

            let step = 'titles';
            let primaryKeyword = '';
            let secondaryKeywords = ['', '', '', '', ''];
            let titles = [];
            let selectedTitle = '';
            let loading = false;
            let error = '';

            // Function to copy text to the clipboard
            const copyToClipboard = (text) => {
                if (text) {
                    const tempInput = document.createElement('textarea');
                    tempInput.value = text;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                }
            };

            // Function to render the loading spinner
            const renderLoadingSpinner = () => `
                <svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            `;

            // Renders the UI based on the current step and state
            const render = () => {
                let content;

                if (step === 'titles') {
                    content = `
                        <div class="space-y-6">
                            <div>
                                <label for="primary-keyword" class="block text-gray-300 font-bold mb-2">Primary Keyword</label>
                                <input
                                    type="text"
                                    id="primary-keyword"
                                    class="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors"
                                    placeholder="e.g., Video Editing Tutorial"
                                    value="${primaryKeyword}"
                                    ${loading ? 'disabled' : ''}
                                />
                            </div>
                            <button id="generate-titles-btn" class="w-full p-4 rounded-lg font-bold text-white transition-all duration-300
                                ${loading ? 'bg-gray-600 cursor-not-allowed' : 'bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 transform hover:scale-105'}"
                                ${loading ? 'disabled' : ''}
                            >
                                ${loading ? renderLoadingSpinner() : 'Generate Titles'}
                            </button>
                            ${error ? `<p class="text-red-400 text-center mt-4">${error}</p>` : ''}

                            ${titles.length > 0 ? `
                                <div class="mt-8">
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-200 mb-4 text-center">
                                        Choose a Title:
                                    </h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        ${titles.map((title, index) => `
                                            <div class="bg-gray-700 p-4 rounded-lg flex flex-col justify-between">
                                                <p class="text-white mb-4 break-words">${title}</p>
                                                <button
                                                    data-title="${title}"
                                                    class="p-2 mt-auto rounded-lg bg-purple-500 hover:bg-purple-600 text-white font-medium transition-colors select-title-btn"
                                                    ${loading ? 'disabled' : ''}
                                                >
                                                    Select this Title
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else if (step === 'descriptions') {
                    content = `
                        <div class="space-y-6">
                            <div>
                                <h2 class="text-xl sm:text-2xl font-bold text-gray-200 mb-4 text-center">
                                    Selected Title:
                                </h2>
                                <div class="bg-gray-700 p-4 sm:p-6 rounded-lg border-2 border-purple-500 shadow-xl">
                                    <p class="text-lg sm:text-xl text-center text-purple-300 mb-4 break-words">
                                        ${selectedTitle}
                                    </p>
                                    <div class="flex justify-center">
                                        <button id="copy-title-btn"
                                            class="p-2 px-4 rounded-lg bg-green-500 hover:bg-green-600 text-white font-medium transition-colors transform hover:scale-105"
                                        >
                                            Copy Title
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label for="primary-keyword-desc" class="block text-gray-300 font-bold mb-2">Primary Keyword</label>
                                <input
                                    type="text"
                                    id="primary-keyword-desc"
                                    class="w-full p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors"
                                    placeholder="e.g., Video Editing Tutorial"
                                    value="${primaryKeyword}"
                                    ${loading ? 'disabled' : ''}
                                />
                            </div>
                            <div>
                                <label class="block text-gray-300 font-bold mb-2">Secondary Keywords (Optional, up to 5)</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                    ${secondaryKeywords.map((keyword, index) => `
                                        <input
                                            type="text"
                                            class="p-3 rounded-lg bg-gray-700 text-white placeholder-gray-400 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors secondary-keyword-input"
                                            placeholder="Keyword ${index + 1}"
                                            value="${keyword}"
                                            data-index="${index}"
                                            ${loading ? 'disabled' : ''}
                                        />
                                    `).join('')}
                                </div>
                            </div>
                            
                            <button id="generate-descriptions-btn" class="w-full p-4 rounded-lg font-bold text-white transition-all duration-300
                                ${loading ? 'bg-gray-600 cursor-not-allowed' : 'bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 transform hover:scale-105'}"
                                ${loading ? 'disabled' : ''}
                            >
                                ${loading ? renderLoadingSpinner() : 'Generate Descriptions'}
                            </button>
                            <button id="go-back-btn" class="w-full p-4 rounded-lg font-bold text-white bg-gray-600 hover:bg-gray-700 transition-colors mt-2">
                                Go Back to Titles
                            </button>

                            ${descriptions.length > 0 ? `
                                <div class="mt-8">
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-200 mb-4 text-center">
                                        Description Ideas:
                                    </h2>
                                    <div class="flex flex-col gap-4">
                                        ${descriptions.map((desc, index) => `
                                            <div class="bg-gray-700 p-4 rounded-lg">
                                                <p class="text-white mb-4 whitespace-pre-wrap">${desc}</p>
                                                <div class="flex justify-center">
                                                    <button
                                                        class="p-2 px-4 rounded-lg bg-green-500 hover:bg-green-600 text-white font-medium transition-colors transform hover:scale-105 copy-description-btn"
                                                        data-desc-text="${desc}"
                                                    >
                                                        Copy Description
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }

                // Main App container
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-900 text-white p-4 sm:p-8 flex items-start justify-center font-sans">
                        <div class="bg-gray-800 p-6 sm:p-10 rounded-xl shadow-2xl w-full max-w-4xl transform transition-all duration-300">
                            <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
                                YouTube Title & Description Generator 🚀
                            </h1>
                            <p class="text-center text-gray-400 mb-8 max-w-lg mx-auto">
                                ${step === 'titles' ? 'Enter a primary keyword to generate title ideas.' : 'Now, generate descriptions using your keywords.'}
                            </p>
                            ${content}
                        </div>
                    </div>
                `;

                // Add event listeners after rendering
                attachEventListeners();
            };

            // Attaches all event listeners for the rendered elements
            const attachEventListeners = () => {
                if (step === 'titles') {
                    document.getElementById('primary-keyword').addEventListener('input', (e) => {
                        primaryKeyword = e.target.value;
                    });
                    document.getElementById('generate-titles-btn').addEventListener('click', generateTitles);
                    document.querySelectorAll('.select-title-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            handleTitleSelection(e.target.dataset.title);
                        });
                    });
                } else if (step === 'descriptions') {
                    document.getElementById('copy-title-btn').addEventListener('click', () => {
                        copyToClipboard(selectedTitle);
                    });
                    document.getElementById('primary-keyword-desc').addEventListener('input', (e) => {
                        primaryKeyword = e.target.value;
                    });
                    document.querySelectorAll('.secondary-keyword-input').forEach(input => {
                        input.addEventListener('input', (e) => {
                            const index = e.target.dataset.index;
                            secondaryKeywords[index] = e.target.value;
                        });
                    });
                    document.getElementById('generate-descriptions-btn').addEventListener('click', generateDescriptions);
                    document.getElementById('go-back-btn').addEventListener('click', () => {
                        step = 'titles';
                        render();
                    });
                    document.querySelectorAll('.copy-description-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            copyToClipboard(e.target.dataset.descText);
                        });
                    });
                }
            };

            // Function to handle the API call for titles
            const generateTitles = async () => {
                if (!primaryKeyword) {
                    error = 'Please enter a primary keyword.';
                    render();
                    return;
                }
                loading = true;
                error = '';
                titles = [];
                render();

                const maxRetries = 5;
                let delay = 1000;

                if (!apiKey) {
                    error = 'API Key is missing. Please add your key to the code to proceed.';
                    loading = false;
                    render();
                    return;
                }

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const prompt = `
                            Generate a JSON array containing 10 creative and effective YouTube titles. Each title must:
                            - Be under 70 characters long.
                            - Include the exact primary keyword: "${primaryKeyword}".
                            - Have a strong hook.
                            - Include a call-to-action (CTA) word.
                            - Contain at least one relevant emoji.
                            - Include some text within brackets, like [Tutorial], (2024), or [LIVE].
                        `;
                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = {
                            contents: chatHistory,
                            generationConfig: {
                                responseMimeType: "application/json",
                                responseSchema: {
                                    type: "ARRAY",
                                    items: { type: "STRING" }
                                }
                            }
                        };
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload),
                        });

                        if (!response.ok) {
                            throw new Error(`API error: ${response.statusText}`);
                        }

                        const result = await response.json();
                        const jsonText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (jsonText) {
                            const parsedJson = JSON.parse(jsonText);
                            if (Array.isArray(parsedJson)) {
                                titles = parsedJson;
                                break;
                            }
                        }
                        throw new Error('No valid titles were generated. Please try again.');
                    } catch (e) {
                        if (i < maxRetries - 1) {
                            console.warn(`Title generation attempt ${i + 1} failed. Retrying...`, e.message);
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                        } else {
                            console.error('All title generation retries failed.', e);
                            error = 'Failed to generate titles. Please try a different keyword or try again later.';
                        }
                    }
                }
                loading = false;
                render();
            };

            // Function to handle the API call for descriptions
            const generateDescriptions = async () => {
                if (!selectedTitle || !primaryKeyword) {
                    error = 'Please select a title and enter a primary keyword.';
                    render();
                    return;
                }
                loading = true;
                error = '';
                descriptions = [];
                render();

                const maxRetries = 5;
                let delay = 1000;
                const filteredSecondaryKeywords = secondaryKeywords.filter(k => k.trim() !== '');
                
                if (!apiKey) {
                    error = 'API Key is missing. Please add your key to the code to proceed.';
                    loading = false;
                    render();
                    return;
                }

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const prompt = `
                            Generate a JSON array containing 5 different YouTube video description ideas for the following title: "${selectedTitle}".
                            Each description must be under 120 words long. It must incorporate the primary keyword "${primaryKeyword}" and also use the following secondary keywords: ${filteredSecondaryKeywords.join(', ')}.
                            Each description should be a few sentences long, include relevant hashtags, and provide a clear call-to-action.
                        `;

                        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                        const payload = {
                            contents: chatHistory,
                            generationConfig: {
                                responseMimeType: "application/json",
                                responseSchema: {
                                    type: "ARRAY",
                                    items: { type: "STRING" }
                                }
                            }
                        };
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload),
                        });

                        if (!response.ok) {
                            throw new Error(`API error: ${response.statusText}`);
                        }

                        const result = await response.json();
                        const jsonText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (jsonText) {
                            const parsedJson = JSON.parse(jsonText);
                            if (Array.isArray(parsedJson)) {
                                descriptions = parsedJson;
                                break;
                            }
                        }
                        throw new Error('The API response was not a valid JSON array of strings. Please try again.');
                    } catch (e) {
                        if (i < maxRetries - 1) {
                            console.warn(`Description generation attempt ${i + 1} failed. Retrying...`, e.message);
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                        } else {
                            console.error('All description generation retries failed.', e);
                            error = 'Failed to generate descriptions. Please try again later.';
                        }
                    }
                }
                loading = false;
                render();
            };
            
            // Initial render
            render();
        });
    </script>
</body>
</html>
